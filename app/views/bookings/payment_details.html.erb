<h4>Your total payment comes to $<%= current_listing.total_price(session[:start_date],session[:end_date]) %></h4>
<div class="demo-frame">
  <%= form_for :checkout_form, url: "checkout" , html: {id: "cardForm" } do |f| %>

    <%= f.label :card_owner, "Full Name (as it appears on the card)", html: {class: "hosted-fields--label"} %>
    <div id="card-nowner" class="hosted-field"></div>

    <%= f.label :card_number, "Credit Card Number", html: {class: "hosted-fields--label"} %>
    <div id="card-number" class="hosted-field"></div>
    
    <%= f.label :expiration_date, "Expiration Date", html: {class: "hosted-fields--label"} %>
    <div id="expiration-date" class="hosted-field"></div>
    
    <%= f.label :cvv, "CVV", html: {class: "hosted-fields--label"} %>
    <div id="cvv" class="hosted-field"></div>
    
    <%= f.hidden_field "payment_method_nonce" %>
    
    <div class="button-container">
      <%= f.submit "Purchase", disabled: true, class: "button button--small button--green", id: "submit-payment-btn" %>
    </div>
  <% end %>
</div>

<!-- Load the Client component. -->
<script src="https://js.braintreegateway.com/web/3.6.3/js/client.min.js"></script>

<!-- Load the Hosted Fields component. -->
<script src="https://js.braintreegateway.com/web/3.6.3/js/hosted-fields.min.js"></script>

<script>
    console.log("Enter payment script");
    var form = document.querySelector('#cardForm'),
        submit = document.querySelector('#submit-payment-btn'),
        authorization = '<%= @client_token %>';

    braintree.client.create({
      authorization: authorization
    }, function (clientErr, clientInstance) {
      if (clientErr) {
        console.error("Client Error: ", clientErr);
        return;
      }
      // This example shows Hosted Fields, but you can also use this
      // client instance to create additional components here, such as
      // PayPal or Data Collector.
      braintree.hostedFields.create({
        client: clientInstance,
        styles: {
          'input': {
            'font-size': '14px'
          },
          'input.invalid': {
            'color': 'red'
          },
          'input.valid': {
            'color': 'green'
          }
        },
        fields: {
          number: {
            selector: '#card-number',
            placeholder: '4111 1111 1111 1111'
          },
          cvv: {
            selector: '#cvv',
            placeholder: '123'
          },
          expirationDate: {
            selector: '#expiration-date',
            placeholder: '10/2019'
          }
        }
      }, function (hostedFieldsErr, hostedFieldsInstance) {
        if (hostedFieldsErr) {
          console.error(hostedFieldsErr);
          return;
        }
        submit.removeAttribute('disabled');
        form.addEventListener('submit', function (event) {
          event.preventDefault();
          hostedFieldsInstance.tokenize(function (tokenizeErr, payload) {
            if (tokenizeErr) {
              console.error("tokenizer error:", tokenizeErr);
              return;
            }
            // If this was a real integration, this is where you would
            // send the nonce to your server.
            document.querySelector('input[name="checkout_form[payment_method_nonce]"]').value = payload.nonce;
            form.submit();
          });
        }, false);
      });
    });
</script>